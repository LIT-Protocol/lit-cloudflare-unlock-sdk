function dataURItoBlob(t){for(var e=atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),a=new Uint8Array(i),o=0;o<e.length;o++)a[o]=e.charCodeAt(o);return new Blob([i],{type:n})}buf2hex=t=>[...new Uint8Array(t)].map((t=>t.toString(16).padStart(2,"0"))).join("");const getSnippet=(t,e)=>`\n  <div class="lit-video-wrapper">\n    <iframe \n        src=""\n        class="lit-video"\n        allow="accelerometer; gyroscope; \n        autoplay; encrypted-media; \n        picture-in-picture;" \n        allowfullscreen="true"\n        data-server="${btoa(window.location.origin)}"\n        data-readable-conditions="${t}"\n        data-lit="${e}">\n    </iframe>\n    <button class="btn-lit-video-unlock">ðŸ”¥  Unlock with Lit-Protocol</button>\n</div>\n\n<script onload="LitJsSdk.litJsSdkLoadedInALIT()" src="https://jscdn.litgateway.com/index.web.js"><\/script>\n<script src="https://cloudflare-unlock-sdk-js-cdn.litgateway.com/0.0.1/lit-unlock.min.js"><\/script>\n<link rel="stylesheet" href="https://cloudflare-unlock-sdk-js-cdn.litgateway.com/0.0.1/lit-unlock.min.css"></link>\n\n`,liveIcon='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M13 12a1 1 0 11-2 0 1 1 0 012 0z" />\n</svg>';async function onClickedUnlock(t){const e=t.parentElement.querySelector(".lit-video-snippet").innerText;navigator.clipboard.writeText(e),t.parentElement.querySelector(".lit-video-msg").classList.add("active");const n=JSON.parse(atob(t.getAttribute("data-lit"))),i=JSON.parse(atob(n.accessControlConditions)),a=JSON.parse(atob(n.resourceId_base64));console.log(`ðŸ”“resourceId: ${JSON.stringify(a)}`);const o=i[0].chain,s=await LitJsSdk.checkAndSignAuthMessage({chain:o}),r=atob(t.getAttribute("data-server"));console.log(`ðŸ”“ SERVER: ${r}`);const l=`${r}/api/video_id?jwt=${await litNodeClient.getSignedToken({accessControlConditions:i,chain:o,authSig:s,resourceId:a})}`;console.warn(l);const c=await fetch(l),d=await c.json();t.src=`https://iframe.videodelivery.net/${d}`,t.parentElement.classList.add("active")}function manipulateWrapper(t){const e=(t,e)=>e.map((e=>t.appendChild(e)));var n,i,a=t.querySelector("iframe"),o=t.querySelector("button"),s=a.getAttribute("data-readable-conditions"),r=Object.assign(document.createElement("div"),{classList:"lit-video-description"}),l=Object.assign(document.createElement("div"),{classList:"lit-video-overlay"}),c=Object.assign(document.createElement("div"),{classList:"lit-video-info",innerText:s}),d=Object.assign(document.createElement("pre"),{classList:"lit-video-snippet",innerText:(n=s,i=a.getAttribute("data-lit"),`\n  <div class="lit-video-wrapper">\n    <iframe \n        src=""\n        class="lit-video"\n        allow="accelerometer; gyroscope; \n        autoplay; encrypted-media; \n        picture-in-picture;" \n        allowfullscreen="true"\n        data-server="${btoa(window.location.origin)}"\n        data-readable-conditions="${n}"\n        data-lit="${i}">\n    </iframe>\n    <button class="btn-lit-video-unlock">ðŸ”¥  Unlock with Lit-Protocol</button>\n</div>\n\n<script onload="LitJsSdk.litJsSdkLoadedInALIT()" src="https://jscdn.litgateway.com/index.web.js"><\/script>\n<script src="https://cloudflare-unlock-sdk-js-cdn.litgateway.com/0.0.1/lit-unlock.min.js"><\/script>\n<link rel="stylesheet" href="https://cloudflare-unlock-sdk-js-cdn.litgateway.com/0.0.1/lit-unlock.min.css"></link>\n\n`),style:"opacity: 0"}),p=Object.assign(document.createElement("div"),{classList:"lit-video-msg",innerText:"copied to Clipboard!"});if(t.insertBefore(p,a),t.insertBefore(l,a),e(l,[r]),e(t,[d]),e(r,[o,c]),"live"==JSON.parse(atob(JSON.parse(atob(a.getAttribute("data-lit"))).resourceId_base64)).extraData){var u=document.createElement("div");u.classList.add("lit-video-live"),u.innerHTML=liveIcon,t.appendChild(u)}return{btn:o,wrapper:t,iframe:a}}[...document.getElementsByClassName("lit-video-wrapper")].forEach((t=>{const{btn:e,wrapper:n,iframe:i}=manipulateWrapper(t);[e,n].forEach((t=>t.addEventListener("click",(()=>onClickedUnlock(i)))))}));
