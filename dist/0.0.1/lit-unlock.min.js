function dataURItoBlob(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),o=new Uint8Array(i),a=0;a<t.length;a++)o[a]=t.charCodeAt(a);return new Blob([i],{type:n})}buf2hex=e=>[...new Uint8Array(e)].map((e=>e.toString(16).padStart(2,"0"))).join("");const getSnippet=(e,t)=>`\n  <div class="lit-video-wrapper">\n    <iframe \n        src=""\n        class="lit-video"\n        allow="accelerometer; gyroscope; \n        autoplay; encrypted-media; \n        picture-in-picture;" \n        allowfullscreen="true"\n        data-server="${btoa(window.location.origin)}"\n        data-readable-conditions="${e}"\n        data-lit="${t}">\n    </iframe>\n    <button class="btn-lit-video-unlock">ðŸ”¥  Unlock with Lit-Protocol</button>\n</div>\n\n<script onload="LitJsSdk.litJsSdkLoadedInALIT()" src="https://jscdn.litgateway.com/index.web.js"><\/script>\n<script src="https://cloudflare-unlock-sdk-js-cdn.litgateway.com/0.0.1/lit-unlock.min.js"><\/script>\n<link rel="stylesheet" href="https://cloudflare-unlock-sdk-js-cdn.litgateway.com/0.0.1/lit-unlock.min.css"></link>\n\n`,liveIcon='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M13 12a1 1 0 11-2 0 1 1 0 012 0z" />\n</svg>';var copyMemory=[];function copySnippet(e,t){if(copyMemory.includes(t))return void alert("Copied already, please wait 5 seconds");console.log("CopyMemory:",copyMemory),console.log(t);const n=e.parentElement.querySelector(".lit-video-snippet").innerText;navigator.clipboard.writeText(n);const i=e.parentElement.querySelector(".lit-video-msg");i.classList.add("active"),copyMemory.push(t),setTimeout((()=>{i.classList.remove("active")}),2e3),setTimeout((()=>{copyMemory=copyMemory.filter((e=>e!=t))}),5e3)}async function onClickedUnlock(e){const t=JSON.parse(atob(e.getAttribute("data-lit"))),n=JSON.parse(atob(t.accessControlConditions)),i=JSON.parse(atob(t.resourceId_base64));console.log(`ðŸ”“resourceId: ${JSON.stringify(i)}`);const o=n[0].chain;copySnippet(e,btoa(e));const a=await LitJsSdk.checkAndSignAuthMessage({chain:o}),s=atob(e.getAttribute("data-server"));console.log(`ðŸ”“ SERVER: ${s}`);const r=`${s}/api/video_id?jwt=${await litNodeClient.getSignedToken({accessControlConditions:n,chain:o,authSig:a,resourceId:i})}`;console.warn(r);const c=await fetch(r),l=await c.json();e.src=`https://iframe.videodelivery.net/${l}`,e.parentElement.classList.add("active")}function manipulateWrapper(e){const t=(e,t)=>t.map((t=>e.appendChild(t)));var n,i,o=e.querySelector("iframe"),a=e.querySelector("button"),s=o.getAttribute("data-readable-conditions"),r=Object.assign(document.createElement("div"),{classList:"lit-video-description"}),c=Object.assign(document.createElement("div"),{classList:"lit-video-overlay"}),l=Object.assign(document.createElement("div"),{classList:"lit-video-info",innerText:s}),d=Object.assign(document.createElement("pre"),{classList:"lit-video-snippet",innerText:(n=s,i=o.getAttribute("data-lit"),`\n  <div class="lit-video-wrapper">\n    <iframe \n        src=""\n        class="lit-video"\n        allow="accelerometer; gyroscope; \n        autoplay; encrypted-media; \n        picture-in-picture;" \n        allowfullscreen="true"\n        data-server="${btoa(window.location.origin)}"\n        data-readable-conditions="${n}"\n        data-lit="${i}">\n    </iframe>\n    <button class="btn-lit-video-unlock">ðŸ”¥  Unlock with Lit-Protocol</button>\n</div>\n\n<script onload="LitJsSdk.litJsSdkLoadedInALIT()" src="https://jscdn.litgateway.com/index.web.js"><\/script>\n<script src="https://cloudflare-unlock-sdk-js-cdn.litgateway.com/0.0.1/lit-unlock.min.js"><\/script>\n<link rel="stylesheet" href="https://cloudflare-unlock-sdk-js-cdn.litgateway.com/0.0.1/lit-unlock.min.css"></link>\n\n`),style:"opacity: 0"}),p=Object.assign(document.createElement("div"),{classList:"lit-video-msg",innerText:"copied to Clipboard!"});if(e.insertBefore(p,o),e.insertBefore(c,o),t(c,[r]),t(e,[d]),t(r,[a,l]),"live"==JSON.parse(atob(JSON.parse(atob(o.getAttribute("data-lit"))).resourceId_base64)).extraData){var u=document.createElement("div");u.classList.add("lit-video-live"),u.innerHTML=liveIcon,e.appendChild(u)}return{btn:a,wrapper:e,iframe:o}}[...document.getElementsByClassName("lit-video-wrapper")].forEach((e=>{const{btn:t,wrapper:n,iframe:i}=manipulateWrapper(e);[t,n].forEach((e=>e.addEventListener("click",(()=>onClickedUnlock(i)))))}));
