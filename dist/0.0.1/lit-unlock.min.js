function dataURItoBlob(t){for(var e=atob(t.split(",")[1]),a=t.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(e.length),i=new Uint8Array(n),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);return new Blob([n],{type:a})}async function onClickedUnlock(t){var e=JSON.parse(atob(t.getAttribute("data-lit")));const a=JSON.parse(atob(e.accessControlConditions)),n=dataURItoBlob(e.encryptedZip),i=buf2hex(new Uint8Array(atob(e.encryptedSymmetricKey).split(",").map((t=>parseInt(t))))),o=a[0].chain,r=await LitJsSdk.checkAndSignAuthMessage({chain:o}),c=await window.litNodeClient.getEncryptionKey({accessControlConditions:a,toDecrypt:i,chain:o,authSig:r}),s=await LitJsSdk.decryptZip(n,c),d=await s["string.txt"].async("text");if(null!=d&""!=d){console.log("Unlocked");const e=`https://iframe.videodelivery.net/${d}`;t.src=e,t.parentElement.classList.add("active")}}async function onClickedUnlockJWT(t){const e=JSON.parse(atob(t.getAttribute("data-lit"))),a=JSON.parse(atob(e.accessControlConditions)),n=JSON.parse(atob(e.resourceId_base64));console.log(n);const i=a[0].chain,o=await LitJsSdk.checkAndSignAuthMessage({chain:i}),r=`http://127.0.0.1:8787/api/video_id?jwt=${await litNodeClient.getSignedToken({accessControlConditions:a,chain:i,authSig:o,resourceId:n})}`;console.warn(r);const c=await fetch(r),s=await c.json();t.src=`https://iframe.videodelivery.net/${s}`,t.parentElement.classList.add("active")}function manipulateWrapper(t){var e=t.querySelector("iframe"),a=t.querySelector("button"),n=e.getAttribute("data-readable-conditions"),i=document.createElement("div");i.classList.add("lit-video-description");var o=document.createElement("div");o.classList.add("lit-video-overlay");var r=document.createElement("span");return r.classList.add("lit-video-info"),r.innerText=n,t.insertBefore(o,e),t.appendChild(i),i.appendChild(a),i.appendChild(r),{btn:a,wrapper:t,iframe:e}}buf2hex=t=>[...new Uint8Array(t)].map((t=>t.toString(16).padStart(2,"0"))).join(""),[...document.getElementsByClassName("lit-video-wrapper")].forEach((t=>{const{btn:e,wrapper:a,iframe:n}=manipulateWrapper(t);[e,a].forEach((t=>t.addEventListener("click",(()=>onClickedUnlockJWT(n)))))}));
